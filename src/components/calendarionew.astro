---
// Importiamo i dati del nostro calendario ufficiale
import calendarData from "../data/calendar-system.json";

// Funzione per formattare la data
function formatDate(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleDateString('it-IT', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
}

// Funzione per formattare l'ora
function formatTime(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleTimeString('it-IT', {
    hour: '2-digit',
    minute: '2-digit'
  });
}

// Funzione per ottenere il nome della squadra
function getTeamName(teamId: string) {
  return calendarData.teams[teamId]?.name || teamId;
}

// Funzione per ottenere il nome breve della squadra
function getTeamShortName(teamId: string) {
  return calendarData.teams[teamId]?.shortName || teamId;
}

// Funzione per ottenere la palestra
function getVenue(match: any) {
  if (match.homeTeam === 'svb') {
    return calendarData.teams.svb.homeVenue;
  } else {
    return calendarData.teams[match.homeTeam]?.homeVenue || match.venue;
  }
}

// Funzione per ottenere l'indirizzo della palestra
function getVenueAddress(match: any) {
  if (match.homeTeam === 'svb') {
    return calendarData.teams.svb.homeVenueAddress;
  } else {
    return calendarData.teams[match.homeTeam]?.homeVenueAddress || '';
  }
}

// Filtriamo solo le partite Serie C
const serieCMatches = calendarData.matches.filter(match => match.competition === 'serie-c');

// Ordiniamo per data
serieCMatches.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

const title = "Calendario 2025/2026";
const subtitle = "Campionato Serie C - Conference Nord Ovest - Italiana - Girone C";
---

<h2
    class="mb-10 mt-20 text-3xl tracking-tight font-extrabold text-gray-900 dark:text-white text-center"
  >
   Trofeo Piperno - Coppa Toscana - Ottavi ad eliminazione diretta
  </h2>

<div class="relative overflow-x-auto">
    <table class="w-full text-sm text-left text-gray-700 dark:text-gray-400 mb-10">
        <thead class="text-bold text-gray-700 uppercase bg-red-700 dark:bg-gray-700 dark:text-gray-400">
            <tr>
              <th data-tooltip-target="tooltip-posizione" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Partita
              </th>
              <th data-tooltip-target="tooltip-squadra" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    Fase
                </th>
                <th data-tooltip-target="tooltip-punti" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    Squadra di casa
                </th>
                <th  data-tooltip-target="tooltip-puntipartita" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Squadra trasferta
                </th>
                <th data-tooltip-target="tooltip-default" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    Data
                </th>
                <th data-tooltip-target="tooltip-default" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Ora
              </th>
              <th data-tooltip-target="tooltip-default" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Luogo
              </th>
            </tr>
        </thead>
        <tbody>
          {
            serieCMatches.slice(0, 8).map((match, index) => (
  
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                   {index + 1}
                </th>
                <td class="px-6 py-4">
                  {match.match_day || `Giornata ${match.round}`}
                </td>
                <td class="px-6 py-4 font-semibold">
                  {getTeamName(match.homeTeam)}
                </td>
                <td class="px-6 py-4 font-semibold">
                  {getTeamName(match.awayTeam)}
                </td>
                <td class="px-6 py-4">
                  {formatDate(match.date)}
                </td>
                <td class="px-6 py-4">
                  {formatTime(match.date)}
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm">
                    <div class="font-medium">{getVenue(match)}</div>
                    <div class="text-gray-500 dark:text-gray-400">{getVenueAddress(match)}</div>
                  </div>
                </td>
            </tr>
            
            )
          )}
        </tbody>
    </table>
  </div>

  <div id="tooltip-posizione" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
    posizione in calendario
    <div class="tooltip-arrow" data-popper-arrow></div>
  </div>
  <div id="tooltip-squadra" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
    Nome della squadra
    <div class="tooltip-arrow" data-popper-arrow></div>
  </div>
  <div id="tooltip-punti" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
    Punti complessivi
    <div class="tooltip-arrow" data-popper-arrow></div>
  </div>

<h2
    class="mb-10 mt-20 text-3xl tracking-tight font-extrabold text-gray-900 dark:text-white text-center"
  >
   {title}
  </h2>

<p class="text-center text-gray-600 dark:text-gray-400 mb-8 text-lg">
  {subtitle}
</p>

<div class="relative overflow-x-auto">
    <table class="w-full text-sm text-left text-gray-700 dark:text-gray-400 mb-10">
        <thead class="text-bold text-gray-700 uppercase bg-blue-700 dark:bg-gray-700 dark:text-gray-400">
            <tr>
              <th data-tooltip-target="tooltip-posizione" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Partita
              </th>
              <th data-tooltip-target="tooltip-squadra" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    Giornata
                </th>
                <th data-tooltip-target="tooltip-punti" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    Squadra di casa
                </th>
                <th  data-tooltip-target="tooltip-puntipartita" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Squadra trasferta
                </th>
                <th data-tooltip-target="tooltip-default" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    Data
                </th>
                <th data-tooltip-target="tooltip-default" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Ora
              </th>
              <th data-tooltip-target="tooltip-default" scope="col" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Luogo
              </th>
            </tr>
        </thead>
        <tbody>
          {
            serieCMatches.map((match, index) => (
  
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                   {index + 1}
                </th>
                <td class="px-6 py-4">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                    {match.round}
                  </span>
                </td>
                <td class="px-6 py-4 font-semibold">
                  <div class="flex items-center space-x-2">
                    <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200">
                      {getTeamShortName(match.homeTeam)}
                    </span>
                    <span>{getTeamName(match.homeTeam)}</span>
                  </div>
                </td>
                <td class="px-6 py-4 font-semibold">
                  <div class="flex items-center space-x-2">
                    <span class="w-6 h-6 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center text-xs font-bold text-red-800 dark:text-red-200">
                      {getTeamShortName(match.awayTeam)}
                    </span>
                    <span>{getTeamName(match.awayTeam)}</span>
                  </div>
                </td>
                <td class="px-6 py-4">
                  {formatDate(match.date)}
                </td>
                <td class="px-6 py-4">
                  {formatTime(match.date)}
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm">
                    <div class="font-medium">{getVenue(match)}</div>
                    <div class="text-gray-500 dark:text-gray-400">{getVenueAddress(match)}</div>
                  </div>
                </td>
            </tr>
            
            )
          )}
        </tbody>
    </table>
  </div>

  <div class="text-center mt-8 mb-16">
    <p class="text-gray-600 dark:text-gray-400 text-sm">
      Calendario ufficiale Serie C 2025/2026 - Conference Nord Ovest - Italiana - Girone C
    </p>
    <p class="text-gray-500 dark:text-gray-500 text-xs mt-2">
      Aggiornato il {new Date().toLocaleDateString('it-IT')}
    </p>
  </div>