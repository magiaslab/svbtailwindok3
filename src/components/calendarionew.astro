---
// Importiamo i dati del nostro calendario ufficiale
import calendarData from "../data/calendar-system.json";
import LucideIcon from "./LucideIcon.astro";

// Funzione per formattare la data
function formatDate(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleDateString('it-IT', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
}

// Funzione per formattare l'ora
function formatTime(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleTimeString('it-IT', {
    hour: '2-digit',
    minute: '2-digit'
  });
}

// Funzione per ottenere il nome della squadra
function getTeamName(teamId: string) {
  return calendarData.teams[teamId]?.name || teamId;
}

// Funzione per ottenere il nome breve della squadra
function getTeamShortName(teamId: string) {
  return calendarData.teams[teamId]?.shortName || teamId;
}

// Funzione per ottenere il logo della squadra
function getTeamLogo(teamId: string) {
  return calendarData.teams[teamId]?.logo || "";
}

// Funzione per ottenere la palestra
function getVenue(match: any) {
  if (match.homeTeam === 'svb') {
    return calendarData.teams.svb.homeVenue;
  } else {
    return calendarData.teams[match.homeTeam]?.homeVenue || match.venue;
  }
}

// Funzione per ottenere l'indirizzo della palestra
function getVenueAddress(match: any) {
  if (match.homeTeam === 'svb') {
    return calendarData.teams.svb.homeVenueAddress;
  } else {
    return calendarData.teams[match.homeTeam]?.homeVenueAddress || '';
  }
}

// Funzione per verificare se SVB gioca in casa
function isSVBHome(match: any) {
  return match.homeTeam === 'svb';
}

// Filtriamo solo le partite Serie C
const serieCMatches = calendarData.matches.filter(match => match.competition === 'serie-c');

// Filtriamo solo le partite Coppa Toscana
const coppaToscanaMatches = calendarData.matches.filter(match => match.competition === 'coppa-toscana');

// Ordiniamo per data
serieCMatches.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
coppaToscanaMatches.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

const title = "Calendario 2025/2026";
const subtitle = "Campionato Serie C - Conference Nord Ovest - Italiana - Girone C";
---

<h2
    class="mb-10 mt-20 text-3xl tracking-tight font-extrabold text-gray-900 dark:text-white text-center"
  >
   Trofeo Piperno - Coppa Toscana - Ottavi ad eliminazione diretta
  </h2>

<div class="relative overflow-x-auto shadow-lg rounded-lg">
    <table class="w-full text-sm text-left text-gray-700 dark:text-gray-400">
        <thead class="text-bold text-gray-700 uppercase bg-gradient-to-r from-red-600 to-red-700 dark:from-red-700 dark:to-red-800">
            <tr>
              <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                  N°
              </th>
              <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                    Fase
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap">
                    Squadra Casa
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap">
                  Squadra Ospite
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                    Data
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                  Ora
              </th>
              <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap">
                  Luogo
              </th>
            </tr>
        </thead>
        <tbody>
          {
            coppaToscanaMatches.map((match, index) => (
  
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white text-center">
                   {match.match_number || index + 1}
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                    {match.round === 1 ? '1ª Giornata' : `Giornata ${match.round}`}
                  </span>
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900 dark:to-red-800 rounded-full flex items-center justify-center shadow-sm p-1">
                      <img 
                        src={getTeamLogo(match.homeTeam)} 
                        alt={getTeamName(match.homeTeam)}
                        class="w-full h-full object-contain rounded-full"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                      />
                      <div class="hidden w-full h-full bg-gradient-to-br from-red-500 to-red-600 rounded-full items-center justify-center text-white font-bold text-xs">
                        {getTeamShortName(match.homeTeam)}
                      </div>
                    </div>
                    <div class="flex flex-col">
                      <span class="font-semibold text-gray-900 dark:text-white">{getTeamName(match.homeTeam)}</span>
                      <span class="text-xs text-gray-500 dark:text-gray-400">{getTeamShortName(match.homeTeam)}</span>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800 rounded-full flex items-center justify-center shadow-sm p-1">
                      <img 
                        src={getTeamLogo(match.awayTeam)} 
                        alt={getTeamName(match.awayTeam)}
                        class="w-full h-full object-contain rounded-full"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                      />
                      <div class="hidden w-full h-full bg-gradient-to-br from-blue-500 to-blue-600 rounded-full items-center justify-center text-white font-bold text-xs">
                        {getTeamShortName(match.awayTeam)}
                      </div>
                    </div>
                    <div class="flex flex-col">
                      <span class="font-semibold text-gray-900 dark:text-white">{getTeamName(match.awayTeam)}</span>
                      <span class="text-xs text-gray-500 dark:text-gray-400">{getTeamShortName(match.awayTeam)}</span>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white text-center">
                  {formatDate(match.date)}
                </td>
                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white text-center">
                  {formatTime(match.date)}
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm max-w-xs">
                    <div class="font-medium text-gray-900 dark:text-white">{getVenue(match)}</div>
                    <div class="text-gray-500 dark:text-gray-400 text-xs">{getVenueAddress(match)}</div>
                  </div>
                </td>
            </tr>
            
            )
          )}
        </tbody>
    </table>
  </div>

<h2
    class="mb-10 mt-20 text-3xl tracking-tight font-extrabold text-gray-900 dark:text-white text-center"
  >
   {title}
  </h2>

<p class="text-center text-gray-600 dark:text-gray-400 mb-8 text-lg">
  {subtitle}
</p>

<div class="relative overflow-x-auto shadow-lg rounded-lg">
    <table class="w-full text-sm text-left text-gray-700 dark:text-gray-400">
        <thead class="text-bold text-gray-700 uppercase bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800">
            <tr>
              <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                  N°
              </th>
              <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                    Giornata
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap">
                    Squadra Casa
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap">
                  Squadra Ospite
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                    Data
                </th>
                <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap text-center">
                  Ora
              </th>
              <th scope="col" class="px-6 py-4 font-semibold text-white whitespace-nowrap">
                  Luogo
              </th>
            </tr>
        </thead>
        <tbody>
          {
            serieCMatches.map((match, index) => (
  
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white text-center">
                   {index + 1}
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                    {match.round}
                  </span>
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800 rounded-full flex items-center justify-center shadow-sm p-1">
                      <img 
                        src={getTeamLogo(match.homeTeam)} 
                        alt={getTeamName(match.homeTeam)}
                        class="w-full h-full object-contain rounded-full"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                      />
                      <div class="hidden w-full h-full bg-gradient-to-br from-blue-500 to-blue-600 rounded-full items-center justify-center text-white font-bold text-xs">
                        {getTeamShortName(match.homeTeam)}
                      </div>
                    </div>
                    <div class="flex flex-col">
                      <span class="font-semibold text-gray-900 dark:text-white">{getTeamName(match.homeTeam)}</span>
                      <span class="text-xs text-gray-500 dark:text-gray-400">{getTeamShortName(match.homeTeam)}</span>
                    </div>
                    {isSVBHome(match) && (
                      <div class="ml-2">
                        <div class="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center">
                          <LucideIcon icon="home" class="w-3 h-3 text-white" />
                        </div>
                      </div>
                    )}
                  </div>
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900 dark:to-red-800 rounded-full flex items-center justify-center shadow-sm p-1">
                      <img 
                        src={getTeamLogo(match.awayTeam)} 
                        alt={getTeamName(match.awayTeam)}
                        class="w-full h-full object-contain rounded-full"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                      />
                      <div class="hidden w-full h-full bg-gradient-to-br from-red-500 to-red-600 rounded-full items-center justify-center text-white font-bold text-xs">
                        {getTeamShortName(match.awayTeam)}
                      </div>
                    </div>
                    <div class="flex flex-col">
                      <span class="font-semibold text-gray-900 dark:text-white">{getTeamName(match.awayTeam)}</span>
                      <span class="text-xs text-gray-500 dark:text-gray-400">{getTeamShortName(match.awayTeam)}</span>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white text-center">
                  {formatDate(match.date)}
                </td>
                <td class="px-6 py-4 font-medium text-gray-900 dark:text-white text-center">
                  {formatTime(match.date)}
                </td>
                <td class="px-6 py-4">
                  <div class="text-sm max-w-xs">
                    <div class="font-medium text-gray-900 dark:text-white">{getVenue(match)}</div>
                    <div class="text-gray-500 dark:text-gray-400 text-xs">{getVenueAddress(match)}</div>
                  </div>
                </td>
            </tr>
            
            )
          )}
        </tbody>
    </table>
  </div>

  <div class="text-center mt-8 mb-16">
    <p class="text-gray-600 dark:text-gray-400 text-sm">
      Calendario ufficiale Serie C 2025/2026 - Conference Nord Ovest - Italiana - Girone C
    </p>
    <p class="text-gray-500 dark:text-gray-500 text-xs mt-2">
      Aggiornato il {new Date().toLocaleDateString('it-IT')}
    </p>
  </div>